# 2026-01-29 Memory Log

## Schedule Changes

### 港股新聞摘要 (hk-stock-news-evening)
- **New schedule:** `0 1-8,10,12,14 * * 1-5` UTC
- **HKT times:** 9am-4pm hourly (8 times) + 6pm, 8pm, 10pm (3 times) = 11 times/day
- **Destinations:** Jason (TG), JC Algos channel (TG), WhatsApp DIM INV Library
- WhatsApp schedule same as Telegram

### Short Selling Report (hk-short-selling-daily)
- **Schedule:** 4:30pm HKT (8:30 UTC) Mon-Fri
- **Destinations:** Jason (TG), JC Algos channel (TG), WhatsApp DIM INV Library

## wacli Configuration Change
- **Before:** `wacli sync --follow` (continuous, locks store)
- **After:** Cron job every 15 minutes: `*/15 * * * * /root/go/bin/wacli sync --timeout 60s`
- **Reason:** Continuous sync locks wacli store, preventing message sends
- **Log:** `/var/log/wacli-sync.log`

## Market Sentiment Analysis Debugging

### Issue 1: Webhook URL
- **Problem:** market_sentiment.py used `http://172.18.0.1:5678/webhook/market-sentiment`
- **Fix:** Changed to `http://localhost:5678/webhook/market-sentiment`
- **Reason:** Script runs on host, not in Docker

### Issue 2: n8n Function Node toFixed Error
- **Error:** `Cannot read properties of undefined (reading 'toFixed')` at line 144
- **Root cause:** `sentiment_percentages` JSON only had `positive` and `negative`, missing `neutral`
- **Fix:** Added neutral percentage to Python output:
  ```python
  "sentiment_percentages": {
      "positive": result['positive_percent'],
      "negative": result['negative_percent'],
      "neutral": (result['neutral_count'] / result['total_articles'] * 100) if result['total_articles'] > 0 else 0
  },
  ```
- **Status:** Still getting 500 error - needs further debugging in n8n UI

### Workflow Info
- **Workflow ID:** M6GuLyuCliDOSTg8
- **Workflow name:** Market Sentiment Analysis
- **Workflow JSON:** `/root/.clawdbot/media/inbound/bad16ab2-4385-48a0-a99c-46b8938a9f03.json`

## Files Modified
- `/root/clawd/projects/market-analyzer/sentiment/market_sentiment.py` - webhook URL + neutral percentage
