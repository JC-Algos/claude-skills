# 2026-02-01 Session Notes

## US Market News Workflow Overhaul
- **Problem**: Jason said US headlines not enough context (unlike HK news), needed Chinese translation
- **Solution**: Updated workflow to:
  - Add AI summarization + translate to Chinese
  - Add CNBC as direct RSS source (via RSSHub)
  - Fix source detection - all headlines now have `[source]` brackets (Bloomberg, WSJ, Reuters, Yahoo, NYT, BBC, Fox, MarketWatch, HKEJ)
  - **No separate China section** for US news (unless directly impacts US markets)
  
- **Schedule updated** (Mon-Fri HKT):
  - 9 PM → 12 AM: every hour
  - 12 AM → 8 AM: every 2 hours
  - Cron: `0 0,13,14,15,16,18,20,22 * * 1-5` (UTC)

## Relay.py Fix
- `/broadcast` endpoint was hardcoded to send `[HK_NEWS_TRIGGER]` for all news
- Fixed to detect `[US_NEWS_BROADCAST]` in message content and use appropriate trigger tag + file path
- File: `/root/clawd/projects/message-relay/relay.py`

## Group Forex Workflow Fix
- **Problem**: `/group forex AUDUSD` command always ran with USDJPY
- **Root cause**: "Set Currency Pair" node had hardcoded `USDJPY`, didn't read from webhook query params
- **Fix**: Changed expression to `={{ $json.query && $json.query.pair ? $json.query.pair : 'USDJPY' }}`
- Note: `?.` optional chaining doesn't work in n8n expressions - use ternary instead

## Self-Improvement Skill
- Logged correction: "every 2 years" typo → "every 2 hours"
- File: `.learnings/LEARNINGS.md` entry `LRN-20260201-001`

## Active Scheduled Jobs Summary
### n8n Workflows (7 active)
- US Market News: Mon-Fri 9PM-8AM HKT (hourly then every 2h)
- HK Market News: Mon-Fri 9AM-9PM HKT every 2h
- HSI Daily Forecast: Mon-Fri 8:30 AM HKT
- Group Forex Analyst: Mon-Fri 8AM, 12PM, 4PM, 8PM HKT

### Clawdbot Cron (11 active)
- HK Stock News, Short Selling, HSI scans, US BB Squeeze scans, Daily Auto-Update

## Technical Notes
- n8n expressions: Use ternary (`a ? b : c`) not optional chaining (`a?.b`)
- Webhook query params: Access via `$json.query.paramName`
- When Schedule Trigger fires (no query), falls back to default - this is correct behavior
